import{_ as p,z as o,A as c,X as n,C as s,T as t,a6 as e,Q as l}from"./framework.fef63301.js";const i={},u=e('<h1 id="图片懒加载" tabindex="-1"><a class="header-anchor" href="#图片懒加载" aria-hidden="true">#</a> 图片懒加载</h1><h2 id="一、实现原理" tabindex="-1"><a class="header-anchor" href="#一、实现原理" aria-hidden="true">#</a> 一、实现原理</h2><p><code>&lt;img&gt;</code>标签本身有一个<code>loading</code>属性来决定是否执行懒加载，但是实测中发现该属性在Edge浏览器中并不起作用，所以需要通过脚本的方式去实现。</p><p>简单来说，还没有出现在用户可见范围内的图像资源不加载</p><p>具体来说，通过判断<code>&lt;img&gt;</code>标签所处的坐标是否出现在了网页视口，将<code>&lt;img&gt;</code>标签的<code>src</code>值替换为存放在<code>data-src</code>属性里的真正图像链接</p><p><strong>判断<code>&lt;img&gt;</code>标签是否出现在可视范围有两种实现方式：</strong></p>',6),r=n("li",null,[s("监听"),n("code",null,"window.onscroll"),s("事件，在回调函数中去对比每个"),n("code",null,"<img>"),s("标签的坐标和窗口尺寸")],-1),d={href:"https://link.juejin.cn/?target=",target:"_blank",rel:"noopener noreferrer"},k=n("code",null,"<img>",-1),g=e('<h2 id="二、前置知识" tabindex="-1"><a class="header-anchor" href="#二、前置知识" aria-hidden="true">#</a> 二、前置知识</h2><h3 id="_1、浏览器屏幕坐标系" tabindex="-1"><a class="header-anchor" href="#_1、浏览器屏幕坐标系" aria-hidden="true">#</a> 1、浏览器屏幕坐标系</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/290f87672eaa42a198ec139a5843f3ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20221103101645081"></p><p>存在<strong>两种坐标系</strong>：</p><ul><li><strong>相对于窗口window</strong>，从窗口的（顶部，左部）开始计算，坐标变量为**<code>clientX</code>和<code>clinetY</code>**</li><li><strong>相对于文档document</strong>，从文档根的（顶部，左部）开始，坐标变量为**<code>pageX</code>和<code>pageY</code>**</li></ul><p>页面滚动到起点时，<code>(pageX,pageY)</code>和<code>(clientX,clientY)</code>相等</p><p>页面发生滚动（即滚动条移动）之后，<code>(pageX,pageY) = (clientX + scrollLeft, clinetY + scrollTop)</code>， 其中<code>scrollTop/scrollLeft</code>代表页面节点与文档根（顶部，左部）的<strong>滚动距离</strong>，可通过<code>window.pageYOffset</code>或<code>document.body.scrollTop</code>或<code>document.documentElement.scrollTop</code>获取</p><h3 id="_2、获取节点坐标-getboundingclinetrect" tabindex="-1"><a class="header-anchor" href="#_2、获取节点坐标-getboundingclinetrect" aria-hidden="true">#</a> 2、获取节点坐标：getBoundingClinetRect</h3>',8),m=n("code",null,"elem.getBoundingClientRect()",-1),v=n("code",null,"elem",-1),b={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fgeometry-1%2F%23domrect",title:"https://www.w3.org/TR/geometry-1/#domrect",target:"_blank",rel:"noopener noreferrer"},h=e(`<p>主要的 <code>DOMRect</code> 属性：</p><ul><li><code>x/y</code> —— 矩形原点相对于窗口的 X/Y 坐标</li><li><code>width/height</code> —— 矩形的 width/height（可以为负，负值表示右下角作为起点，正常是左上角作为起点）</li></ul><p>此外，还有派生（derived）属性：</p><ul><li><code>top/bottom</code> —— 顶部/底部矩形边缘的 Y 坐标</li><li><code>left/right</code> —— 左/右矩形边缘的 X 坐标</li></ul><p><strong>width/height为正数时的示意图如下：</strong></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2a251cd511a64e689827a8f1c3bd251d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20221103104333989"></p><p><strong>width/height为正数时的示意图如下：</strong></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c29183be90f34fe58a02d6b47ce185b1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20221103104751579"></p><p><strong>总结：获取节点的坐标</strong></p><ol start="0"><li>相对于窗口的坐标 —— <code>elem.getBoundingClientRect()</code>。</li><li>相对于文档的坐标 —— <code>elem.getBoundingClientRect()</code> 加上当前页面滚动。</li></ol><h3 id="_3、获取窗口尺寸" tabindex="-1"><a class="header-anchor" href="#_3、获取窗口尺寸" aria-hidden="true">#</a> 3、获取窗口尺寸</h3><p>窗口有两种定义，一种是当前窗口的实际大小（可能因为被缩小而变化），另外一种是屏幕的大小（固定值）</p><p><strong>第一种，获取当前窗口实际大小，使用window对象</strong></p><table><thead><tr><th></th><th>现代浏览器</th><th>老版浏览器</th></tr></thead><tbody><tr><td>窗口内高度（除去了菜单栏、工具栏等等）</td><td>innerHeight</td><td>document.documentElement.clientHeight 或 document.body.clientHeight</td></tr><tr><td>窗口内宽度</td><td>innerWidth</td><td>document.documentElement.clientWidth 或document.body.clientWidth</td></tr></tbody></table><p><strong>第二种，获取屏幕固定宽高</strong></p><table><thead><tr><th>screen.width</th><th>屏幕宽度</th></tr></thead><tbody><tr><td>screen.height</td><td>屏幕高度</td></tr></tbody></table><h3 id="_4、判断节点是否在可视范围" tabindex="-1"><a class="header-anchor" href="#_4、判断节点是否在可视范围" aria-hidden="true">#</a> 4、判断节点是否在可视范围</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isInView</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>elem<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top <span class="token operator">&lt;=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5、intersection-observer" tabindex="-1"><a class="header-anchor" href="#_5、intersection-observer" aria-hidden="true">#</a> 5、Intersection Observer</h3>`,19),f={href:"https://link.juejin.cn/?target=",target:"_blank",rel:"noopener noreferrer"},y={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FGlossary%2FViewport",title:"https://developer.mozilla.org/zh-CN/docs/Glossary/Viewport",target:"_blank",rel:"noopener noreferrer"},_=e(`<p>该接口可以方便的检测元素的可视状态，应用场景广泛：</p><ul><li>当页面滚动时，懒加载图片或其他内容。</li><li>实现“可无限滚动”网站，也就是当用户滚动网页时直接加载更多内容，无需翻页。</li><li>对某些元素进行埋点曝光</li><li>滚动到相应区域来执行相应动画或其他任务。</li></ul><p><strong>构造器</strong></p><p><code>IntersectionObserver()</code>，接受一个回调函数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> hList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;h3&#39;</span><span class="token punctuation">)</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>hList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果如下：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aaeb6fa7ffe24d47b3b19b749ec6d26b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20221103130154181"></p><p>可以看到<code>enries</code>是一个<code>IntersectionObserverEntry</code>对象数组，该对象的属性如上，其中<code>isIntersecting</code>是一个Boolean值，表示被观察的节点是否与文档视窗交叉（即有没有出现在可见窗口中）</p>`,8),w=n("thead",null,[n("tr",null,[n("th",null,"属性"),n("th",null,"说明")])],-1),q={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FIntersectionObserver%2Froot",title:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/root",target:"_blank",rel:"noopener noreferrer"},I=n("code",null,"IntersectionObserver.root",-1),F={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FElement",title:"https://developer.mozilla.org/zh-CN/docs/Web/API/Element",target:"_blank",rel:"noopener noreferrer"},j=n("code",null,"element",-1),z=n("code",null,"null",-1),x=n("thead",null,[n("tr",null,[n("th",null,"方法"),n("th",null,"说明")])],-1),C={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FIntersectionObserver%2Fdisconnect",title:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/disconnect",target:"_blank",rel:"noopener noreferrer"},A=n("code",null,"disconnect()",-1),O=n("td",null,[s("使"),n("code",null,"IntersectionObserver"),s("对象停止监听工作")],-1),E=n("tr",null,[n("td",null,"[`observe()"),n("td",null,"开始监听一个目标元素")],-1),L={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FIntersectionObserver%2Funobserve",title:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/unobserve",target:"_blank",rel:"noopener noreferrer"},R=n("code",null,"unobserve()",-1),N=n("td",null,"停止监听特定目标元素",-1),P=e(`<p><strong>用法示例：</strong></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">h3</span> <span class="token punctuation">{</span>
            margin<span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>测试文本1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>测试文本2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>测试文本3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>测试文本4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>测试文本5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> node <span class="token operator">=</span> entry<span class="token punctuation">.</span>target
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>textContent <span class="token operator">+</span> <span class="token string">&#39; 出现在了窗口中&#39;</span><span class="token punctuation">)</span>
                    observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> hList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;h3&#39;</span><span class="token punctuation">)</span>
        hList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f30394885da047b087f008ad10a4c1c0~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20221103130952810"></p><h2 id="三、动手实践" tabindex="-1"><a class="header-anchor" href="#三、动手实践" aria-hidden="true">#</a> 三、动手实践</h2><p>第一种方式：监听<code>window.onscroll</code>事件，在回调中判断图片是否出现在窗口可视范围，使用节流优化监听事件</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">img</span><span class="token punctuation">{</span>
            display<span class="token punctuation">:</span> block<span class="token punctuation">;</span>
            height<span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://tse4-mm.cn.bing.net/th/id/OIP-C.nRlAFygdctTCHmIWN7GxRwHaEK?pid=ImgDet&amp;rs=1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://qiuzcc-typora-images.oss-cn-shenzhen.aliyuncs.com/images/2022/202210141603798.JPG<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
​
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://tse4-mm.cn.bing.net/th/id/OIP-C.nRlAFygdctTCHmIWN7GxRwHaEK?pid=ImgDet&amp;rs=1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://qiuzcc-typora-images.oss-cn-shenzhen.aliyuncs.com/images/2022/%E9%AA%91%E8%A1%8C.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
​
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://tse4-mm.cn.bing.net/th/id/OIP-C.nRlAFygdctTCHmIWN7GxRwHaEK?pid=ImgDet&amp;rs=1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://qiuzcc-typora-images.oss-cn-shenzhen.aliyuncs.com/images/2022/202210141601847.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
​
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://tse4-mm.cn.bing.net/th/id/OIP-C.nRlAFygdctTCHmIWN7GxRwHaEK?pid=ImgDet&amp;rs=1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://qiuzcc-typora-images.oss-cn-shenzhen.aliyuncs.com/images/2022/202210121140688.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://tse4-mm.cn.bing.net/th/id/OIP-C.nRlAFygdctTCHmIWN7GxRwHaEK?pid=ImgDet&amp;rs=1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://qiuzcc-typora-images.oss-cn-shenzhen.aliyuncs.com/images/2022/202205270028510.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span>delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> timeoutId<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span>
                <span class="token keyword">let</span> args <span class="token operator">=</span> arguments
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>timeoutId<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    timeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        timeoutId<span class="token operator">=</span><span class="token keyword">null</span>
                        <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>args<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>delay<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
       
        <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token number">0</span>   <span class="token comment">//start需要声明为全局变量，否则每次调用函数start都会重新刷新为0，也就失去了它的意义了</span>
        <span class="token keyword">function</span> <span class="token function">imgLazyLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;触发imgLazyLoad&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> imgs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>imgs<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> img <span class="token operator">=</span> imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top <span class="token operator">&lt;=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    img<span class="token punctuation">.</span>src <span class="token operator">=</span> img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src
                    start <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        window<span class="token punctuation">.</span>onscroll <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span>imgLazyLoad<span class="token punctuation">,</span><span class="token number">250</span><span class="token punctuation">)</span>
        <span class="token function">imgLazyLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二种方式：使用<code>IntersectionObserver</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//替换&lt;script&gt;部分</span>
<span class="token keyword">function</span> <span class="token function">imgLazyLoad</span><span class="token punctuation">(</span><span class="token parameter">imgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    imgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> image <span class="token operator">=</span> event<span class="token punctuation">.</span>target
            image<span class="token punctuation">.</span>src <span class="token operator">=</span> image<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src
            observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;triger&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>imgLazyLoad<span class="token punctuation">)</span>
<span class="token keyword">let</span> imgs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span>
imgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">img</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>IntersectionObserver</code>允许你追踪目标元素与其祖先元素或视窗的交叉状态</p><p>通过<code>isIntersecting</code>属性来判断是否出现</p><ul><li><code>observer.observe</code>添加交叉监听，给每个img添加监听</li><li><code>observer.unobserve</code>取消交叉监听，img出现时给src赋值，并取消监听</li></ul><h2 id="四、性能提升效果" tabindex="-1"><a class="header-anchor" href="#四、性能提升效果" aria-hidden="true">#</a> 四、性能提升效果</h2><p>为了放大对比效果，特意选择了体积较大的图像文件</p><p>首先是没有懒加载时的加载时间：一共花了20.7s，五张图片一共19.4M</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90e0d2415652405ea3a64af27a7a4c4e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20221103112657840"></p><p>使用懒加载后，首次只加载前三张图片，一共花了5.03s，三张图片8.4M</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b9ddf17fbb84f61a38cc0482b1515ba~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20221103120837216"></p>`,17);function T(W,H){const a=l("ExternalLinkIcon");return o(),c("div",null,[u,n("ol",null,[r,n("li",null,[s("使用"),n("a",d,[s("Intersection Observer"),t(a)]),s("这个接口，判断"),k,s("标签是否出现在可视范围")])]),g,n("p",null,[s("方法 "),m,s(" 返回最小矩形的窗口坐标，该矩形将 "),v,s(" 作为内建 "),n("a",b,[s("DOMRect"),t(a)]),s(" 类的对象。")]),h,n("p",null,[n("a",f,[s("该接口"),t(a)]),s("提供了一种异步观察目标元素与其祖先元素或顶级文档视窗 ("),n("a",y,[s("viewport"),t(a)]),s(") 交叉状态的方法")]),_,n("table",null,[w,n("tbody",null,[n("tr",null,[n("td",null,[n("a",q,[I,t(a)])]),n("td",null,[s("所监听对象的具体祖先元素 ("),n("a",F,[j,t(a)]),s(")。如果未传入值或值为"),z,s("，则默认使用顶级文档的视窗")])])])]),n("table",null,[x,n("tbody",null,[n("tr",null,[n("td",null,[n("a",C,[A,t(a)])]),O]),E,n("tr",null,[n("td",null,[n("a",L,[R,t(a)])]),N])])]),P])}const Y=p(i,[["render",T],["__file","index.html.vue"]]);export{Y as default};
